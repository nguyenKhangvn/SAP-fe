<div class="dialog-container">
  <h2 mat-dialog-title>Chi tiết đơn hàng</h2>
  
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Đang tải dữ liệu...</p>
  </div>

  <mat-dialog-content *ngIf="!isLoading && order">
    <div class="order-header">
      <div class="order-info">
        <p><strong>Mã đơn hàng:</strong> {{ order.orderCode }}</p>
        <p><strong>Khách hàng:</strong> {{ order.customerId?.name || 'Không xác định' }}</p>
        <p><strong>Ngày đặt hàng:</strong> {{ order.date | date:'dd/MM/yyyy' }}</p>
        <p><strong>Trạng thái:</strong> 
          <span [ngClass]="order.isPaid ? 'status-paid' : 'status-debt'">
            {{ order.isPaid ? 'Đã thanh toán' : 'Còn nợ' }}
          </span>
        </p>
      </div>
    </div>

    <h3>Sản phẩm đã đặt</h3>
    
    <table mat-table [dataSource]="order.items" class="products-table mat-elevation-z1" *ngIf="order.items?.length > 0">
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef>Mã sản phẩm</th>
        <td mat-cell *matCellDef="let item">{{ item.product.productCode || 'N/A' }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Tên sản phẩm</th>
        <td mat-cell *matCellDef="let item">{{ item.product.name }}</td>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>Số lượng</th>
        <td mat-cell *matCellDef="let item">{{ item.quantity }}</td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Đơn giá</th>
        <td mat-cell *matCellDef="let item">{{ formatCurrency(item.price) }} ₫</td>
      </ng-container>

      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef>Thành tiền</th>
        <td mat-cell *matCellDef="let item">{{ formatCurrency(item.price * item.quantity) }} ₫</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['code', 'name', 'quantity', 'price', 'subtotal']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['code', 'name', 'quantity', 'price', 'subtotal']"></tr>
    </table>

    <div *ngIf="!order.items?.length" class="no-items">
      <mat-icon>info</mat-icon>
      <p>Không có thông tin sản phẩm</p>
    </div>
    
    <div class="order-summary">
      <p class="total"><strong>Tổng tiền:</strong> <span>{{ formatCurrency(order.total) }} ₫</span></p>
      <p *ngIf="order.note" class="note"><strong>Ghi chú:</strong> {{ order.note }}</p>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="close()">Đóng</button>
  </mat-dialog-actions>
</div>
